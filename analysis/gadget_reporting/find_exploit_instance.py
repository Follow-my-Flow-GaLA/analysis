from pymongo import MongoClient
client = MongoClient("mongodb://localhost:27017/")
db = client["phase3"]
collection = db["cookie_url_exploit"]

'''
structure: 
{
    '_id': 'javatpoint_com', 
    'exploit_list': [
        {
            'var_name': 'x69', 
            'row_col': ['19, 1290', '19, 1300'], 
            'src_payload': 'text', 
            'file_name': 'https://ssl\\2Egoogle-analytics\\2Ecom/ga\\2Ejs', 
            'sink_type': 'javascript', 
            'sink_payload': 'text', 
            'start_pos': 32, 
            'end_pos': 36, 
            'sink_string': 'document.writeln("<script type=\'text/javascript\' src=\'http://img1.ph-126.net/google.js\'></script>");', 
            'message_id': '10,', 
            'code': 'document.writeln("<script type=\'MyString', 
            'exploit': 'text/javascript\'>"+(console.log(67890))+"\'></script>");//'
        }
    ]
}

Note: The collection contains 164 documents.
'''

### find affected sites of containing target_js_file_name
target_js_file_name = "require\\2Ejs"

site_set = set()

for document in collection.find():
    for exploit in document["cookie_url_exploit"]:
        if target_js_file_name in exploit["file_name"] and 'baseURL' in exploit["var_name"]:
            site_set.add(document["_id"])
            break

print(site_set)

### print exploit_list of the site
site = "pokemon_com"
for document in collection.find({"_id": site}):
    for exploit in document["cookie_url_exploit"]:
        print(exploit)
